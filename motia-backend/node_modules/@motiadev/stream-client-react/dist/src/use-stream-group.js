import { useCallback, useEffect, useState } from 'react';
import { useMotiaStream } from './use-motia-stream';
/**
 * A hook to get a group of items from a stream.
 *
 * @example
 * ```tsx
 * const { data } = useStreamGroup<{ id:string; name: string }>({
 *   streamName: 'my-stream',
 *   groupId: '123',
 * })
 *
 * return (
 *   <div>
 *     {data.map((item) => (
 *       <div key={item.id}>{item.name}</div>
 *     ))}
 *   </div>
 * )
 * ```
 */
export const useStreamGroup = (args) => {
    const { stream } = useMotiaStream();
    const [data, setData] = useState([]);
    const [event, setEvent] = useState(null);
    const { streamName, groupId, sortKey } = args || {};
    const handleChange = useCallback((data) => {
        setData(data);
    }, []);
    useEffect(() => {
        if (!streamName || !groupId || !stream)
            return;
        const subscription = stream.subscribeGroup(streamName, groupId, sortKey);
        subscription.addChangeListener(handleChange);
        setEvent(subscription);
        return () => {
            setData([]);
            setEvent(null);
            subscription.close();
        };
    }, [stream, streamName, groupId, sortKey, handleChange]);
    return { data, event };
};
