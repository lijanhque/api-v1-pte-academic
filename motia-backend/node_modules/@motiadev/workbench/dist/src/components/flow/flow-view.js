import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { Background, BackgroundVariant, ReactFlow, } from '@xyflow/react';
import { useCallback, useState } from 'react';
import { BaseEdge } from './base-edge';
import { FlowLoader } from './flow-loader';
import { useGetFlowState } from './hooks/use-get-flow-state';
import { NodeOrganizer } from './node-organizer';
import '@xyflow/react/dist/style.css';
import { BackgroundEffect } from '@motiadev/ui';
const edgeTypes = {
    base: BaseEdge,
};
export const FlowView = ({ flow, flowConfig }) => {
    const { nodes, edges, onNodesChange, onEdgesChange, nodeTypes } = useGetFlowState(flow, flowConfig);
    const [initialized, setInitialized] = useState(false);
    const onInitialized = useCallback(() => setInitialized(true), []);
    const onNodesChangeHandler = useCallback((changes) => onNodesChange(changes), [onNodesChange]);
    if (!nodeTypes) {
        return null;
    }
    return (_jsxs("div", { className: "w-full h-full relative", children: [!initialized && _jsx(FlowLoader, {}), _jsxs(ReactFlow, { minZoom: 0.1, nodes: nodes, edges: edges, nodeTypes: nodeTypes, edgeTypes: edgeTypes, onNodesChange: onNodesChangeHandler, onEdgesChange: onEdgesChange, className: "isolate", children: [_jsx(BackgroundEffect, {}), _jsx(Background, { variant: BackgroundVariant.Dots, gap: 20, size: 1 }), _jsx(NodeOrganizer, { onInitialized: onInitialized, nodes: nodes, edges: edges })] })] }));
};
