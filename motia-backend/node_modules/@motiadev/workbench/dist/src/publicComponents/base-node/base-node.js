import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { Button, cn } from '@motiadev/ui';
import { ScanSearch } from 'lucide-react';
import { useCallback, useEffect, useState } from 'react';
import { useHandlePositions } from '@/hooks/use-update-handle-positions';
import { BaseHandle } from './base-handle';
import { NodeHeader } from './node-header';
import { NodeSidebar } from './node-sidebar';
export const BaseNode = ({ title, variant, children, disableSourceHandle, disableTargetHandle, language, subtitle, data, }) => {
    const [isOpen, setIsOpen] = useState(false);
    const { sourcePosition, targetPosition, toggleTargetPosition, toggleSourcePosition } = useHandlePositions(data);
    const [content, setContent] = useState(null);
    const [features, setFeatures] = useState([]);
    const fetchContent = useCallback(async () => {
        const response = await fetch(`/__motia/step/${data.id}`);
        const responseData = await response.json();
        setContent(responseData.content);
        setFeatures(responseData.features);
    }, [data.id]);
    useEffect(() => {
        if (data.id && isOpen) {
            fetchContent();
        }
    }, [data.id, isOpen, fetchContent]);
    return (_jsxs("div", { className: cn('p-1 rounded-lg max-w-[350px]', {
            'bg-muted-foreground/20': isOpen,
        }), children: [_jsx("div", { className: "rounded-lg dark:bg-[#101010] bg-background border-1 border-muted-foreground/30 border-solid", "data-testid": `node-${title?.toLowerCase().replace(/ /g, '-')}`, children: _jsxs("div", { className: "group relative", children: [_jsx(NodeHeader, { text: title, variant: variant, className: "border-b-2 border-muted-foreground/10", children: _jsx("div", { className: "flex justify-end", children: _jsx(Button, { "data-testid": `open-code-preview-button-${title?.toLowerCase()}`, variant: "ghost", className: "h-5 p-0.5", onClick: () => setIsOpen(true), children: _jsx(ScanSearch, { className: "w-4 h-4" }) }) }) }), subtitle && _jsx("div", { className: "py-4 px-6 text-sm text-muted-foreground", children: subtitle }), children && (_jsx("div", { className: "p-2", children: _jsx("div", { className: cn('space-y-3 p-4 text-sm text-muted-foreground', {
                                    'bg-card': variant !== 'noop',
                                }), children: children }) })), !disableTargetHandle && (_jsx(BaseHandle, { type: "target", position: targetPosition, onTogglePosition: toggleTargetPosition })), !disableSourceHandle && (_jsx(BaseHandle, { type: "source", position: sourcePosition, onTogglePosition: toggleSourcePosition }))] }) }), content && (_jsx(NodeSidebar, { features: features, content: content, title: title, subtitle: subtitle, variant: variant, language: language, isOpen: isOpen, onClose: () => setIsOpen(false) }))] }));
};
