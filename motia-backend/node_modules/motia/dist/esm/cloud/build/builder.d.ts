import type { ApiRouteConfig, Step, StepConfig } from '@motiadev/core';
import type { Stream } from '@motiadev/core/dist/src/types-stream';
import type { BuildListener } from '../new-deployment/listeners/listener.types';
export type StepType = 'node' | 'python' | 'noop' | 'unknown';
export type BuildStepConfig = {
    type: StepType;
    entrypointPath: string;
    config: StepConfig;
    filePath: string;
};
export type BuildStreamConfig = {
    name: string;
    storageType: 'default' | 'custom';
};
export type BuildStepsConfig = Record<string, BuildStepConfig>;
export type BuildStreamsConfig = Record<string, BuildStreamConfig>;
export type BuildRoutersConfig = Partial<Record<StepType, string>>;
export type StepsConfigFile = {
    steps: BuildStepsConfig;
    streams: BuildStreamsConfig;
    routers: BuildRoutersConfig;
};
export interface RouterBuildResult {
    compressedSize: number;
    uncompressedSize: number;
    path: string;
}
export interface StepBuilder {
    build(step: Step): Promise<void>;
    buildApiSteps(steps: Step<ApiRouteConfig>[]): Promise<RouterBuildResult>;
}
export declare class Builder {
    readonly projectDir: string;
    private readonly listener;
    readonly stepsConfig: BuildStepsConfig;
    readonly streamsConfig: BuildStreamsConfig;
    routersConfig: BuildRoutersConfig;
    readonly stepCompressedSizes: Map<string, number>;
    readonly stepUncompressedSizes: Map<string, number>;
    readonly routerCompressedSizes: Map<string, number>;
    readonly routerUncompressedSizes: Map<string, number>;
    modulegraphInstalled: boolean;
    private readonly builders;
    constructor(projectDir: string, listener: BuildListener);
    registerBuilder(type: string, builder: StepBuilder): void;
    registerStateStream(stream: Stream): void;
    registerStep(args: {
        entrypointPath: string;
        bundlePath: string;
        step: Step;
        type: StepType;
    }): void;
    recordStepSize(step: Step, compressedSize: number, uncompressedSize: number): void;
    buildStep(step: Step): Promise<void>;
    buildApiSteps(steps: Step<ApiRouteConfig>[]): Promise<void>;
    private determineStepType;
}
