export const createPluginContext = (motiaServer) => {
    const { motia, addRoute, removeRoute, printer } = motiaServer;
    return {
        printer,
        tracerFactory: motia.tracerFactory,
        state: motia.stateAdapter,
        lockedData: motia.lockedData,
        registerApi: (config, handler) => {
            const apiConfig = {
                type: 'api',
                name: `Plugin API: ${config.method} ${config.path}`,
                path: config.path,
                method: config.method,
                emits: [],
                flows: ['_plugin'],
            };
            const step = {
                filePath: `__plugin_${Date.now()}_${config.method}_${config.path.replace(/\//g, '_')}.ts`,
                version: '1',
                config: apiConfig,
                handler,
            };
            addRoute(step);
            return () => {
                removeRoute(step);
            };
        },
    };
};
