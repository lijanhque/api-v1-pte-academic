"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.collectPluginSteps = void 0;
const node_fs_1 = __importDefault(require("node:fs"));
const core_1 = require("@motiadev/core");
const glob_1 = require("glob");
const collectPluginSteps = async (dirname, stepPatterns, projectRoot, printer) => {
    const pluginSteps = [];
    if (!node_fs_1.default.existsSync(dirname)) {
        printer.printPluginWarn(`Directory not found: ${dirname}`);
        return pluginSteps;
    }
    for (const pattern of stepPatterns) {
        try {
            const stepFiles = (0, glob_1.globSync)(pattern, { absolute: true, cwd: dirname });
            if (stepFiles.length === 0) {
                printer.printPluginLog(`No files found matching pattern: ${pattern} in ${dirname}`);
                continue;
            }
            for (const filePath of stepFiles) {
                try {
                    const config = await (0, core_1.getStepConfig)(filePath, projectRoot);
                    if (config) {
                        pluginSteps.push({ filePath, config });
                    }
                    else {
                        printer.printPluginWarn(`No config found in step ${filePath}, step skipped`);
                    }
                }
                catch (error) {
                    printer.printPluginError(`Error loading step ${filePath}:`, error);
                }
            }
        }
        catch (error) {
            printer.printPluginError(`Error processing pattern ${pattern}:`, error);
        }
    }
    return pluginSteps;
};
exports.collectPluginSteps = collectPluginSteps;
