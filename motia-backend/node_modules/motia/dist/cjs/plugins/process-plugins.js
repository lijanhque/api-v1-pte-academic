"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.processPlugins = void 0;
const create_plugin_context_1 = require("./create-plugin-context");
const load_config_1 = require("./load-config");
const process_steps_1 = require("./process-steps");
const processPlugins = async (motiaServer) => {
    const { printer, motia } = motiaServer;
    const baseDir = motia.lockedData.baseDir;
    const context = (0, create_plugin_context_1.createPluginContext)(motiaServer);
    const appConfig = await (0, load_config_1.loadConfig)(baseDir, printer);
    if (!appConfig?.plugins) {
        printer.printPluginError('No plugins found in motia.config.ts');
        return [];
    }
    const plugins = appConfig.plugins?.flatMap((item) => item(context)) || [];
    await (0, process_steps_1.processSteps)(motiaServer, plugins, baseDir);
    return plugins;
};
exports.processPlugins = processPlugins;
