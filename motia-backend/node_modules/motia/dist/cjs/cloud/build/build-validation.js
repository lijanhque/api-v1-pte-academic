"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateStepsConfig = exports.buildValidation = void 0;
const api_endpoints_validator_1 = require("./validations/api-endpoints.validator");
const cron_expressions_validator_1 = require("./validations/cron-expressions.validator");
const duplicate_step_names_validator_1 = require("./validations/duplicate-step-names.validator");
const infrastructure_configs_validator_1 = require("./validations/infrastructure-configs.validator");
const router_bundle_sizes_validator_1 = require("./validations/router-bundle-sizes.validator");
const step_bundle_sizes_validator_1 = require("./validations/step-bundle-sizes.validator");
const step_name_lengths_validator_1 = require("./validations/step-name-lengths.validator");
const buildValidation = (builder, listener) => {
    const { errors, warnings } = (0, exports.validateStepsConfig)(builder);
    if (warnings.length > 0) {
        warnings.forEach((warning) => listener.onBuildWarning(warning));
    }
    if (errors.length > 0) {
        listener.onBuildErrors(errors);
        return false;
    }
    return true;
};
exports.buildValidation = buildValidation;
const validationPipeline = [
    duplicate_step_names_validator_1.duplicateStepNamesValidator,
    step_bundle_sizes_validator_1.stepBundleSizesValidator,
    cron_expressions_validator_1.cronExpressionsValidator,
    api_endpoints_validator_1.apiEndpointsValidator,
    step_name_lengths_validator_1.stepNameLengthsValidator,
    infrastructure_configs_validator_1.infrastructureConfigsValidator,
    router_bundle_sizes_validator_1.routerBundleSizesValidator,
];
const runValidationPipeline = (builder, validators) => {
    return validators.reduce((acc, validator) => {
        const result = validator(builder);
        return {
            errors: [...acc.errors, ...result.errors],
            warnings: [...acc.warnings, ...result.warnings],
        };
    }, { errors: [], warnings: [] });
};
const validateStepsConfig = (builder) => {
    return runValidationPipeline(builder, validationPipeline);
};
exports.validateStepsConfig = validateStepsConfig;
