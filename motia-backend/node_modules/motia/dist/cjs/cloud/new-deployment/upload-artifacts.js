"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.uploadArtifacts = void 0;
const upload_1 = require("./utils/upload");
const uploadArtifacts = async (builder, deploymentToken, listener) => {
    const stepEntries = Object.entries(builder.stepsConfig);
    const routerEntries = Object.entries(builder.routersConfig);
    await Promise.all([
        ...stepEntries.map(async ([stepPath, stepConfig]) => {
            listener.stepUploadStart(stepPath, stepConfig);
            await (0, upload_1.upload)(deploymentToken, stepPath, (progress) => {
                listener.stepUploadProgress(stepPath, stepConfig, progress);
            });
            listener.stepUploadEnd(stepPath, stepConfig);
        }),
        ...routerEntries.map(async ([language, routerPath]) => {
            listener.routeUploadStart(routerPath, language);
            await (0, upload_1.upload)(deploymentToken, routerPath, (progress) => {
                listener.routeUploadProgress(routerPath, language, progress);
            });
            listener.routeUploadEnd(routerPath, language);
        }),
    ]);
};
exports.uploadArtifacts = uploadArtifacts;
