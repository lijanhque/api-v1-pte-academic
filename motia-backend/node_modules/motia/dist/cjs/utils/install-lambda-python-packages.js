"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.installLambdaPythonPackages = void 0;
const child_process_1 = require("child_process");
const fs_1 = __importDefault(require("fs"));
const internal_logger_1 = require("./internal-logger");
const installLambdaPythonPackages = ({ isVerbose = false, requirementsList }) => {
    const sitePackagesPath = `${process.env.PYTHON_SITE_PACKAGES}-lambda`;
    for (const requirement of requirementsList) {
        if (!fs_1.default.existsSync(requirement)) {
            if (isVerbose) {
                internal_logger_1.internalLogger.warn(`requirements.txt not found at ${requirement}`);
            }
            return;
        }
        try {
            // Install packages to lambda site-packages with platform specification
            const command = `pip install -r "${requirement}" --target "${sitePackagesPath}" --platform manylinux2014_x86_64 --only-binary=:all: --upgrade --upgrade-strategy only-if-needed`;
            if (isVerbose) {
                console.log('ðŸ“¦ Installing Python packages with platform specification...');
                console.log('ðŸ“¦ Command:', command);
            }
            (0, child_process_1.execSync)(command, { stdio: 'inherit' });
            internal_logger_1.internalLogger.info('Python packages for lambda installed successfully');
        }
        catch (error) {
            internal_logger_1.internalLogger.error('Failed to install Python packages for lambda', error.message);
            throw error;
        }
    }
};
exports.installLambdaPythonPackages = installLambdaPythonPackages;
