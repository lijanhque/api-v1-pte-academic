"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createStep = createStep;
const colors_1 = __importDefault(require("colors"));
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const getAnswers_1 = require("./getAnswers");
const teamplateUtils_1 = require("./teamplateUtils");
const overrides_1 = require("./templates/ui/overrides");
const utils_1 = require("./utils");
async function createStep(options) {
    try {
        const answers = await (0, getAnswers_1.getStepAnswers)();
        // Create steps directory if it doesn't exist
        const stepDir = path_1.default.join(process.cwd(), 'steps', options?.stepFilePath || '');
        if (!fs_1.default.existsSync(stepDir)) {
            fs_1.default.mkdirSync(stepDir, { recursive: true });
        }
        // Create step file
        const extension = (0, utils_1.getFileExtension)(answers.language);
        const stepPath = path_1.default.join(stepDir, `${answers.name}${answers.type === 'api' ? '.api' : ''}.step${extension}`);
        // Check if file already exists
        if (fs_1.default.existsSync(stepPath)) {
            console.error(colors_1.default.red(`\n‚ùå Error: Step file already exists at ${stepPath}`));
            process.exit(1);
        }
        // Generate and write step file
        const stepContent = await (0, teamplateUtils_1.generateTemplate)(answers);
        fs_1.default.writeFileSync(stepPath, stepContent);
        console.log(colors_1.default.green(`\n‚ú® Created step file at ${stepPath}`));
        // Create UI override if requested
        if (answers.createOverride) {
            const overridePath = path_1.default.join(stepDir, `${answers.name}.step.tsx`);
            const overrideContent = await (0, overrides_1.generateOverride)(answers);
            fs_1.default.writeFileSync(overridePath, overrideContent);
            console.log(colors_1.default.green(`‚ú® Created UI override at ${overridePath}`));
        }
        console.log(colors_1.default.bold('\nüéâ Step creation complete!'));
    }
    catch (error) {
        console.error(colors_1.default.red('\n‚ùå Error creating step:'), error);
        process.exit(1);
    }
}
